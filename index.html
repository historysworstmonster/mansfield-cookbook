<script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxXPtZ8v72kp-C_riwi3gR3iRTM87ad31pY6-pXLUynPe-kbLCh_3nlojpKQXq6E8mt/exec";

    window.onload = function() {
        loadData("RSVPs", "dishTable");
        loadData("Suggestions", "suggestionList");
        loadData("Recommendations", "recList");
    };

    async function loadData(sheetName, elementId) {
        if (WEB_APP_URL.includes("PASTE_YOUR_NEW_URL")) return;
        try {
            const response = await fetch(`${WEB_APP_URL}?sheet=${sheetName}`);
            const data = await response.json();
            const element = document.getElementById(elementId);

            if (sheetName === "RSVPs") {
                const tbody = element.getElementsByTagName('tbody')[0];
                tbody.innerHTML = data.length ? "" : "<tr><td colspan='3' style='text-align:center;'>No entries yet!</td></tr>";
                data.forEach(row => {
                    const tr = tbody.insertRow();
                    tr.innerHTML = `<td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td>`;
                });
            } else if (sheetName === "Suggestions") {
                element.innerHTML = data.length ? "" : "No suggestions yet.";
                data.forEach(row => {
                    // row[0] is the Idea, row[1] is the Vote count
                    const voteCount = row[1] || 0;
                    element.innerHTML += `
                        <div class="suggestion-item">
                            <span>${row[0]}</span>
                            <div class="vote-controls">
                                <span class="vote-count" style="margin-right:10px; font-weight:bold; color:var(--gold);">${voteCount}</span>
                                <button class="vote-btn" onclick="handleVote('${row[0]}')">â†‘ Vote</button>
                            </div>
                        </div>`;
                });
            } else if (sheetName === "Recommendations") {
                element.innerHTML = data.length ? "" : "No recommendations yet.";
                data.forEach(row => {
                    element.innerHTML += `<div class="rec-item"><strong>${row[0]}:</strong> ${row[1]}</div>`;
                });
            }
        } catch (e) { console.log("Load error: ", e); }
    }

    async function handleVote(ideaId) {
        // Optimistically update the UI so it feels fast
        console.log("Voting for: " + ideaId);
        
        await fetch(`${WEB_APP_URL}?action=upvote&id=${encodeURIComponent(ideaId)}&sheet=Suggestions`, {
            method: "POST",
            mode: "no-cors"
        });
        
        // Refresh the list to show the new count from Google
        setTimeout(() => loadData("Suggestions", "suggestionList"), 1000);
    }

    async function sendToSheet(sheetName, dataArray, elementId) {
        // When adding a new suggestion, we send [Idea, 0] so it starts with 0 votes
        const finalData = sheetName === "Suggestions" ? [dataArray[0], 0] : dataArray;
        
        await fetch(`${WEB_APP_URL}?sheet=${sheetName}`, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify(finalData)
        });
        setTimeout(() => loadData(sheetName, elementId), 1500);
    }

    // ... (Keep your saveRSVP, saveSugg, saveRec, and Timer functions) ...
</script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mansfield Cook Book Club</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
    <style>
        :root { --lib-navy: #003366; --lib-gold: #b59410; --lib-light: #e6eff7; }
        body { font-family: 'Fredoka', sans-serif; background: #f4f4f4; margin: 0; color: #333; }
        #countdown-container { background: var(--lib-navy); color: white; padding: 15px; text-align: center; font-weight: 600; border-bottom: 4px solid var(--lib-gold); }
        header { text-align: center; padding: 60px 20px; background-image: linear-gradient(rgba(0, 51, 102, 0.7), rgba(0, 51, 102, 0.7)), url('https://images.unsplash.com/photo-1543353071-873f17a7a088?auto=format&fit=crop&w=1600&q=80'); background-size: cover; color: white; }
        .container { max-width: 950px; margin: 30px auto; padding: 20px; }
        .card { background: white; padding: 25px; margin-bottom: 25px; border-radius: 4px; border-left: 6px solid var(--lib-navy); box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: var(--lib-navy); border-bottom: 2px solid var(--lib-light); padding-bottom: 10px; margin-top: 0; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th { text-align: left; background: var(--lib-light); padding: 10px; color: var(--lib-navy); }
        td { padding: 10px; border-bottom: 1px solid #eee; }
        .recipe-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 20px; }
        .recipe-card { background: var(--lib-light); padding: 15px; border-radius: 6px; position: relative; }
        .recipe-card h3 { margin: 0 0 10px; font-size: 1.1rem; color: var(--lib-navy); }
        .btn { background: var(--lib-navy); color: white; padding: 10px 15px; border: none; border-radius: 4px; text-decoration: none; font-weight: bold; cursor: pointer; display: inline-block; font-family: 'Fredoka'; }
        .btn:hover { background: var(--lib-gold); }
        .search-box { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px; font-family: 'Fredoka'; box-sizing: border-box; }
        .delete-btn { color: #ccc; cursor: pointer; float: right; border: none; background: none; font-size: 1.2rem; }
        .delete-btn:hover { color: #cc0000; }
        .input-group { display: flex; gap: 10px; flex-wrap: wrap; background: #f9f9f9; padding: 15px; border-radius: 4px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 4px; flex: 1; font-family: 'Fredoka'; }
    </style>
</head>
<body>

<div id="countdown-container">⏳ Next Feast: <span id="timer">Loading...</span></div>

<header><h1>Mansfield Cook Book Club</h1></header>

<div class="container">
    <section class="card">
        <h2>Dish Signup: The Preppy Kitchen</h2>
        <table id="dishTable">
            <thead><tr><th>Member</th><th>Dish</th><th>Source</th></tr></thead>
            <tbody><tr><td colspan="3">Loading signups...</td></tr></tbody>
        </table>
        <div class="input-group">
            <input type="text" id="nameIn" placeholder="Your Name">
            <input type="text" id="dishIn" placeholder="What are you bringing?">
            <input type="text" id="sourceIn" placeholder="Page # or Source">
            <button class="btn" onclick="saveRSVP()">Sign Up</button>
        </div>
    </section>

    <section class="card">
        <h2>Digital Recipe Archive</h2>
        <input type="text" id="recipeSearch" class="search-box" placeholder="Search past recipes..." onkeyup="filterRecipes()">
        <div id="recipeGrid" class="recipe-grid">Loading archive...</div>
    </section>
</div>

<script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzoGpvJLQsxZCQL77jp4R3PD189bjkCdFbZ9o8qUHXLHtjdi6FPCxW1rF5u-NXl3ChM/exec";
    let allRecipes = [];

    async function loadData() {
        try {
            // Load RSVPs
            const rsvpRes = await fetch(WEB_APP_URL + "?sheet=RSVPs");
            const rsvpData = await rsvpRes.json();
            const tbody = document.querySelector("#dishTable tbody");
            tbody.innerHTML = "";
            rsvpData.forEach(row => {
                const tr = tbody.insertRow();
                tr.innerHTML = `<td>${row[0]}</td><td>${row[1]}</td><td>${row[2]} <button class="delete-btn" onclick="deleteEntry('RSVPs','${row[1]}')">×</button></td>`;
            });

            // Load Archive
            const archRes = await fetch(WEB_APP_URL + "?sheet=Archive");
            allRecipes = await archRes.json();
            renderRecipes(allRecipes);
        } catch (e) { console.error(e); }
    }

    function renderRecipes(data) {
        const grid = document.getElementById("recipeGrid");
        grid.innerHTML = data.length ? "" : "No recipes found.";
        data.forEach(row => {
            if(row[0]) {
                grid.innerHTML += `
                    <div class="recipe-card">
                        <button class="delete-btn" onclick="deleteEntry('Archive','${row[0]}')">×</button>
                        <h3>${row[0]}</h3>
                        <p>${row[1] || ""}</p>
                        <a href="${row[2]}" target="_blank" class="btn">View PDF</a>
                    </div>`;
            }
        });
    }

    async function saveRSVP() {
        const n = document.getElementById('nameIn').value, d = document.getElementById('dishIn').value, s = document.getElementById('sourceIn').value;
        if(!n || !d) return;
        await fetch(WEB_APP_URL + "?sheet=RSVPs", { method: "POST", mode: "no-cors", body: JSON.stringify([n, d, s]) });
        location.reload();
    }

    async function deleteEntry(sheet, id) {
        if(!confirm("Remove this entry?")) return;
        await fetch(`${WEB_APP_URL}?action=delete&id=${encodeURIComponent(id)}&sheet=${sheet}`, { method: "POST", mode: "no-cors" });
        setTimeout(() => location.reload(), 500);
    }

    function filterRecipes() {
        const term = document.getElementById("recipeSearch").value.toLowerCase();
        const filtered = allRecipes.filter(r => r[0].toLowerCase().includes(term) || (r[1] && r[1].toLowerCase().includes(term)));
        renderRecipes(filtered);
    }

    // Countdown Logic
    const nextMeeting = new Date("Feb 19, 2026 18:00:00").getTime();
    setInterval(() => {
        const now = new Date().getTime(), diff = nextMeeting - now;
        const d = Math.floor(diff / 86400000), h = Math.floor((diff % 86400000) / 3600000), m = Math.floor((diff % 3600000) / 60000);
        document.getElementById("timer").innerHTML = d + "d " + h + "h " + m + "m ";
    }, 1000);

    window.onload = loadData;
</script>
</body>
</html>
